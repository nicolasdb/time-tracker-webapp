{% extends "base.html" %}

{% block title %}RFID Events - Time Tracker Journey{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-semibold text-gray-900">RFID Events</h1>
        <a href="{{ url_for('rfid_events.create_event_form') }}" class="px-5 py-2.5 text-sm font-medium text-white bg-cyan-600 rounded-lg hover:bg-cyan-700 focus:ring-4 focus:ring-cyan-200">
            Add Manual Event
        </a>
    </div>
    
    <!-- Filters -->
    <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-6">
        <h2 class="text-lg font-medium text-gray-900 mb-4">Filters</h2>
        <form action="{{ url_for('rfid_events.list_events') }}" method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label for="start_date" class="block mb-2 text-sm font-medium text-gray-900">Start Date</label>
                <input type="date" name="start_date" id="start_date" value="{{ filters.start_date }}" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-cyan-600 focus:border-cyan-600 block w-full p-2.5">
            </div>
            
            <div>
                <label for="end_date" class="block mb-2 text-sm font-medium text-gray-900">End Date</label>
                <input type="date" name="end_date" id="end_date" value="{{ filters.end_date }}" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-cyan-600 focus:border-cyan-600 block w-full p-2.5">
            </div>
            
            <div>
                <label for="tag_uid" class="block mb-2 text-sm font-medium text-gray-900">Tag UID</label>
                <input type="text" name="tag_uid" id="tag_uid" value="{{ filters.tag_uid }}" placeholder="Filter by Tag UID" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-cyan-600 focus:border-cyan-600 block w-full p-2.5">
            </div>
            
            <div class="flex items-end">
                <button type="submit" class="px-5 py-2.5 text-sm font-medium text-white bg-cyan-600 rounded-lg hover:bg-cyan-700 focus:ring-4 focus:ring-cyan-200">
                    Apply Filters
                </button>
                <a href="{{ url_for('rfid_events.list_events') }}" class="ml-2 px-5 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:ring-gray-200">
                    Reset
                </a>
            </div>
        </form>
    </div>
    
    <!-- Events List -->
    <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8 mb-6">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">ID</th>
                        <th scope="col" class="px-6 py-3">Tag</th>
                        <th scope="col" class="px-6 py-3">Project</th>
                        <th scope="col" class="px-6 py-3">Event Type</th>
                        <th scope="col" class="px-6 py-3">Timestamp</th>
                        <th scope="col" class="px-6 py-3">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            {{ event.id }}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <span class="font-medium text-gray-900">{{ event.tag_name }}</span>
                                <span class="ml-2 text-xs text-gray-500">({{ event.tag_uid }})</span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            {{ event.project }}
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-medium {% if event.event_type == 'placed' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %} rounded-full">
                                {{ event.event_type }}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            {{ event.timestamp }}
                        </td>
                        <td class="px-6 py-4 flex space-x-2">
                            <a href="{{ url_for('rfid_events.edit_event_form', event_id=event.id) }}" class="font-medium text-cyan-600 hover:underline">Edit</a>
                            <form action="{{ url_for('rfid_events.delete_event', event_id=event.id) }}" method="POST" class="inline">
                                <button type="submit" class="font-medium text-red-600 hover:underline" onclick="return confirm('Are you sure you want to delete this event?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if pagination.pages > 1 %}
        <div class="flex items-center justify-between pt-4 border-t border-gray-200 sm:px-6">
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing <span class="font-medium">{{ (pagination.page - 1) * pagination.limit + 1 }}</span> to <span class="font-medium">{{ min(pagination.page * pagination.limit, pagination.total) }}</span> of <span class="font-medium">{{ pagination.total }}</span> results
                    </p>
                </div>
                <div>
                    <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                        <!-- Previous Page -->
                        {% if pagination.page > 1 %}
                        <a href="{{ url_for('rfid_events.list_events', page=pagination.page-1, limit=pagination.limit, start_date=filters.start_date, end_date=filters.end_date, tag_uid=filters.tag_uid) }}" class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                            <span class="sr-only">Previous</span>
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% else %}
                        <span class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300">
                            <span class="sr-only">Previous</span>
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        {% endif %}
                        
                        <!-- Page numbers -->
                        {% for page_num in range(1, pagination.pages + 1) %}
                            {% if page_num == pagination.page %}
                            <span class="relative z-10 inline-flex items-center bg-cyan-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600">
                                {{ page_num }}
                            </span>
                            {% else %}
                            <a href="{{ url_for('rfid_events.list_events', page=page_num, limit=pagination.limit, start_date=filters.start_date, end_date=filters.end_date, tag_uid=filters.tag_uid) }}" class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                                {{ page_num }}
                            </a>
                            {% endif %}
                        {% endfor %}
                        
                        <!-- Next Page -->
                        {% if pagination.page < pagination.pages %}
                        <a href="{{ url_for('rfid_events.list_events', page=pagination.page+1, limit=pagination.limit, start_date=filters.start_date, end_date=filters.end_date, tag_uid=filters.tag_uid) }}" class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                            <span class="sr-only">Next</span>
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                        {% else %}
                        <span class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300">
                            <span class="sr-only">Next</span>
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Time Blocks Generated from Events -->
    <div class="bg-white shadow rounded-lg p-4 sm:p-6 xl:p-8">
        <h2 class="text-lg font-medium text-gray-900 mb-4">Generated Time Blocks</h2>
        <p class="text-sm text-gray-600 mb-4">These time blocks are automatically generated from pairs of placed/removed RFID events.</p>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">Project</th>
                        <th scope="col" class="px-6 py-3">Start Time</th>
                        <th scope="col" class="px-6 py-3">End Time</th>
                        <th scope="col" class="px-6 py-3">Duration</th>
                        <th scope="col" class="px-6 py-3">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Example time blocks -->
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900">Project A</td>
                        <td class="px-6 py-4">May 13, 2025 09:30 AM</td>
                        <td class="px-6 py-4">May 13, 2025 12:45 PM</td>
                        <td class="px-6 py-4">3h 15m</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                                Complete
                            </span>
                        </td>
                    </tr>
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900">Project B</td>
                        <td class="px-6 py-4">May 13, 2025 13:15 PM</td>
                        <td class="px-6 py-4">May 13, 2025 15:30 PM</td>
                        <td class="px-6 py-4">2h 15m</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                                Complete
                            </span>
                        </td>
                    </tr>
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium text-gray-900">Project C</td>
                        <td class="px-6 py-4">May 13, 2025 16:00 PM</td>
                        <td class="px-6 py-4">—</td>
                        <td class="px-6 py-4">Running</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">
                                In Progress
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
